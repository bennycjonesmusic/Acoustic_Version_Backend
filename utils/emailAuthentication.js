export const sendEmailVerifiedConfirmationEmail = async (email) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: email,
    subject: 'Your email has been verified!',
    html: `
      <h2>âœ… Email Verified</h2>
      <p>Thank you for verifying your email address. Your account is now fully activated and you can enjoy all features of Acoustic-version!</p>
      <p>To download purchased tracks, and access guide tracks e.t.c, please navigate to My Profile. Everything you need is there. Thank you again. </p>

      <p>If you have any questions or need help, just reply to this email.</p>
      <p>Welcome to the Acoustic Version community!</p>
      <br>
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};
//edit this and personalise it as needed. Generated by AI. come back to it
import dotenv from 'dotenv'; 
dotenv.config(); 
import nodemailer from 'nodemailer';

const transporter = nodemailer.createTransport({
  service: 'Gmail', // or use SendGrid, Outlook, etc.
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASS,
  },
});

export const sendVerificationEmail = async (email, token) => {
  const verifyUrl = `${process.env.BASE_URL}/auth/verify-email?token=${token}`; //build the url

  //temp email for testing
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: email,
    subject: 'Please verify your email',
    html: `
      <h2>Welcome to Acoustic-version, your home for custom acoustic backing tracks!</h2>
      <p>Click the link below to verify your email:</p>
      <a href="${verifyUrl}">${verifyUrl}</a>
      <p>This link will expire in 24 hours.</p>
    `,
  };

  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendPasswordResetEmail = async (email, token) => {
  if (!process.env.CLIENT_URL) throw new Error('CLIENT_URL is not set in environment variables');
  const resetUrl = `${process.env.CLIENT_URL}/reset-password?token=${token}`;
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: email,
    subject: 'Password Reset Request',
    html: `
      <h2>Password Reset</h2>
      <p>Click the link below to reset your password. This link will expire in 1 hour.</p>
      <a href="${resetUrl}">${resetUrl}</a>
      <p>If you did not request this, you can ignore this email.</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendPurchaseReceiptEmail = async (buyerEmail, track, artist, session) => {
  const downloadUrl = track.fileUrl; // or a secure download link
  const mailOptions = {
    from: `"Backing Tracks" <${process.env.EMAIL_USER}>`,
    to: buyerEmail,
    subject: `Your purchase receipt: ${track.title}`,
    html: `
      <h2>Thank you for your purchase!</h2>
      <p>You bought <b>${track.title}</b> by ${track.originalArtist}.</p>
      <p>Sold by: ${artist?.username || 'the artist'} (${artist?.email || ''})</p>
      <p>Price: $${track.price}</p>
      <p><a href="${downloadUrl}">Download your track</a></p>
      <p>Order ID: ${session.id}</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendSaleNotificationEmail = async (sellerEmail, track, buyer, session) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: sellerEmail,
    subject: `You sold a track: ${track.title}`,
    html: `
      <h2>Congratulations!</h2>
      <p>Your track <b>${track.title}</b> was purchased by ${buyer?.username || buyer?.email || 'a user'}.</p>
      <p>Price: $${track.price}</p>
      <p>Order ID: ${session.id}</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendRefundNotificationEmail = async (email, trackId, refundStatus) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: email,
    subject: 'Your track refund has been processed',
    text: `Your refund for track ID ${trackId} has been processed. If you have any questions, please contact support.\nStripe refund status: ${refundStatus}`
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

// Commission email notifications
export const sendCommissionRequestEmail = async (artistEmail, artistName, customerName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: artistEmail,
    subject: 'New Commission Request',
    html: `
      <h2>ðŸŽµ New Commission Request!</h2>
      <p>Hi ${artistName},</p>
      <p>You have received a new commission request from <strong>${customerName}</strong>.</p>
      
      <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>Commission Details:</h3>
        <p><strong>Customer:</strong> ${customerName}</p>
        <p><strong>Requirements:</strong> ${commissionDetails.requirements}</p>
        <p><strong>Price:</strong> Â£${commissionDetails.customerPrice}</p>
        ${commissionDetails.guideTrackUrl ? `<p><strong>Guide Track:</strong> <a href="${commissionDetails.guideTrackUrl}">Listen here</a></p>` : ''}
      </div>
      
      <p>Please log in and navigate to your artist dashboard to review and respond to this commission request.</p>
      <p><a href="${process.env.CLIENT_URL}/artist-dashboard" style="background-color: #059669; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">View Commission Request</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionAcceptedEmail = async (customerEmail, customerName, artistName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: customerEmail,
    subject: 'Commission Request Accepted!',
    html: `
      <h2>ðŸŽ‰ Great News! Your Commission Was Accepted</h2>
      <p>Hi ${customerName},</p>
      <p><strong>${artistName}</strong> has accepted your commission request!</p>
      
      <div style="background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>Next Steps:</h3>
        <p>Your commission is now ready for payment. Once payment is completed, ${artistName} will begin working on your custom backing track.</p>
        <p><strong>Commission Price:</strong> Â£${commissionDetails.customerPrice}</p>
      </div>
      
      <p>Please complete your payment to get your commission started.</p>
      <p><a href="${process.env.CLIENT_URL}/my-commission-requests" style="background-color: #2563eb; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Complete Payment</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionRejectedEmail = async (customerEmail, customerName, artistName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: customerEmail,
    subject: 'Commission Request Update',
    html: `
      <h2>Commission Request Update</h2>
      <p>Hi ${customerName},</p>
      <p>Unfortunately, <strong>${artistName}</strong> is unable to take on your commission request at this time.</p>
      
      <div style="background-color: #fef3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <p>Don't worry! You can browse other talented artists on our platform who might be perfect for your project.</p>
      </div>
      
      <p><a href="${process.env.CLIENT_URL}/tracks" style="background-color: #059669; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Browse Artists</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionPaymentConfirmationEmail = async (customerEmail, customerName, artistName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: customerEmail,
    subject: 'Commission Payment Confirmed',
    html: `
      <h2>âœ… Payment Confirmed!</h2>
      <p>Hi ${customerName},</p>
      <p>Your payment for the commission with <strong>${artistName}</strong> has been successfully processed.</p>
      
      <div style="background-color: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>What's Next:</h3>
        <p>ðŸ“§ ${artistName} has been notified that payment is complete</p>
        <p>ðŸŽµ Work on your custom backing track will begin shortly</p>
        <p>ðŸ“± You'll receive updates as progress is made</p>
        <p>ðŸ“‹ Track progress in your commission requests dashboard</p>
      </div>
      
      <p><strong>Estimated Delivery:</strong> ${commissionDetails.deliveryTime || 'As discussed with the artist'}</p>
      
      <p><a href="${process.env.CLIENT_URL}/my-commission-requests" style="background-color: #2563eb; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Track Progress</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionPaymentNotificationToArtistEmail = async (artistEmail, artistName, customerName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: artistEmail,
    subject: 'Commission Payment Received - Ready to Start!',
    html: `
      <h2>ðŸ’° Payment Received!</h2>
      <p>Hi ${artistName},</p>
      <p>Great news! <strong>${customerName}</strong> has completed payment for your commission.</p>
      
      <div style="background-color: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>Commission Details:</h3>
        <p><strong>Customer:</strong> ${customerName}</p>
        <p><strong>Requirements:</strong> ${commissionDetails.requirements}</p>
        <p><strong>Your Payout:</strong> Â£${commissionDetails.artistPrice}</p>
        ${commissionDetails.guideTrackUrl ? `<p><strong>Guide Track:</strong> <a href="${commissionDetails.guideTrackUrl}">Listen here</a></p>` : ''}
      </div>
      
      <p>You can now begin work on this commission. Please keep the customer updated on your progress through the commission dashboard.</p>
      
      <p><a href="${process.env.CLIENT_URL}/artist-dashboard" style="background-color: #059669; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Start Working</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionDeliveredEmail = async (customerEmail, customerName, artistName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: customerEmail,
    subject: 'ðŸŽµ Your Commission is Ready for Review!',
    html: `
      <h2>ðŸŽ‰ Your Custom Track is Ready!</h2>
      <p>Hi ${customerName},</p>
      <p><strong>${artistName}</strong> has completed your commission and uploaded a preview for your review.</p>
      
      <div style="background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>What's Next:</h3>
        <p>ðŸŽ§ Listen to the preview of your custom backing track</p>
        <p>âœ… Approve the track if you're happy with it</p>
        <p>ðŸ”„ Request changes if needed (you have revision options)</p>
      </div>
      
      <p>Please review your commission and let us know your decision. Once approved, you'll receive the full high-quality track for download.</p>
      
      <p><a href="${process.env.CLIENT_URL}/my-commission-requests" style="background-color: #2563eb; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Review Your Track</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionApprovedEmail = async (artistEmail, artistName, customerName, commissionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: artistEmail,
    subject: 'âœ… Commission Approved - Payment Processing!',
    html: `
      <h2>ðŸŽ‰ Excellent Work!</h2>
      <p>Hi ${artistName},</p>
      <p>Fantastic news! <strong>${customerName}</strong> has approved your commission.</p>
      
      <div style="background-color: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>Payment Information:</h3>
        <p>ðŸ’° Your payout of <strong>Â£${commissionDetails.artistPrice}</strong> is now being processed</p>
        <p>ðŸ“… Funds will be transferred to your account within 2-7 business days</p>
        <p>ðŸ“§ You'll receive a notification when the transfer is complete</p>
      </div>
      
      <p>Thank you for delivering excellent work! The customer now has access to download their custom backing track.</p>
      
      <p><a href="${process.env.CLIENT_URL}/artist-dashboard" style="background-color: #059669; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">View Commission</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};

export const sendCommissionRevisionRequestedEmail = async (artistEmail, artistName, customerName, revisionDetails) => {
  const mailOptions = {
    from: `"Acousticversion" <${process.env.EMAIL_USER}>`,
    to: artistEmail,
    subject: 'Commission Revision Requested',
    html: `
      <h2>ðŸ”„ Revision Request</h2>
      <p>Hi ${artistName},</p>
      <p><strong>${customerName}</strong> has requested some changes to their commission.</p>
      
      <div style="background-color: #fef3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
        <h3>Revision Details:</h3>
        <p><strong>Revision ${revisionDetails.revisionCount} of ${revisionDetails.maxRevisions}</strong></p>
        ${revisionDetails.feedback ? `<p><strong>Customer Feedback:</strong> ${revisionDetails.feedback}</p>` : ''}
      </div>
      
      <p>Please review the feedback and make the requested changes. You can upload the revised track through your artist dashboard.</p>
      
      <p><a href="${process.env.CLIENT_URL}/artist-dashboard" style="background-color: #d97706; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">Upload Revision</a></p>
      
      <p>Best regards,<br>The Acousticversion Team</p>
    `,
  };
  if (process.env.NODE_ENV === 'test') return;
  await transporter.sendMail(mailOptions);
};